<!DOCTYPE html>
<html lang='en' dir='ltr'>
  <head>
    <meta charset='utf-8'>
    <title>Register in Mimoza</title>
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css'>
  </head>
  <body>
    <div>
      <div>
        <img src='mimoza.png'>
      </div>
      <div>
        <img src='background.jpg'>
        <div>
          <div class='ui hidden divider'></div>
          <div class='ui center aligned medium pink header'><i>Create an Account</i></div>
          <div class='ui hidden divider'></div>
          <div class='input-holder'>
            <div class='ui transparent input'>
              <input type='text' placeholder='Username' id='user'>
            </div>
            <i class='user icon'></i>
          </div>
          <div class='err-holder'>
            <p id='err-user'>none</p>
          </div>
          <div class='ui hidden divider'></div>
          <div class='input-holder'>
            <div class='ui transparent input'>
              <input type='email' placeholder='Email' id='email'>
            </div>
            <i class='envelope icon'></i>
          </div>
          <div class='err-holder'>
            <p id='err-email'>none</p>
          </div>
          <div class='ui hidden divider'></div>
          <div class='input-holder'>
            <div class='ui transparent input'>
              <input type='password' placeholder='Password' id='pass'>
            </div>
            <i class='key icon'></i>
          </div>
          <div class='err-holder'>
            <p id='err-pass'>none</p>
          </div>
          <div class='ui hidden divider'></div>
          <div class='input-holder'>
            <div class='ui transparent input'>
              <input type='password' placeholder='Retype password' id='retype-pass'>
            </div>
            <i class='key icon'></i>
          </div>
          <div class='err-holder'>
            <p id='err-retype-pass'>none</p>
          </div>
          <div class='ui hidden divider'></div>
          <div class='ui checkbox'>
            <input type='checkbox' id='gdpr'>
            <label>By creating an account you agree to our <a href='https://google.com'>Terms of Sercice and Privacy Policy</a></label>
          </div>
          <div class='ui hidden divider'></div>
          <div class='ui pink button' id='register'><i>REGISTER</i></div>
        </div>
        <img src='background.jpg'>
      </div>
    </div>
    <style>
      * {
        font-family: Segoe UI
      }
      body > div:nth-of-type(1) {
        margin: 0 auto
      }
      body > div:nth-of-type(1) > div:nth-of-type(1) {
        padding: 3% 40%;
        background-color: black
      }
      body > div:nth-of-type(1) > div:nth-of-type(1) > img:only-child {
        width: 100%;
        margin: 0 auto
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > img {
        float: left;
        width: 30%;
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div {
        float: left;
        width: 40%
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(2) {
        margin-top: 15%;
        margin-bottom: 5%;
        font-size: 20px
      }
      .input-holder {
        text-align: center
      }
      .input-holder > div {
        display: inline-block;
        width: 40%;
        border-bottom: 1px solid gainsboro
      }
      .input-holder > div > input {
        width: 100%
      }
      .err-holder {
        text-align: center
      }
      .err-holder > p {
        text-align: left;
        display: inline-block;
        width: 40%;
        color: white;
        font-size: 13px
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(16) {
        width: 40%;
        display: table;
        margin: 0 auto;
        border-bottom: 1px solid white
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(16) > label {
        color: deeppink;
        font-size: 10px;
        text-align: center
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(16) > label > a {
        color: deeppink
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(16) > label > a:hover {
        text-decoration: underline
      }
      body > div:nth-of-type(1) > div:nth-of-type(2) > div > div:nth-of-type(18) {
        width: 40%;
        padding: 12px;
        display: table;
        margin: 0 auto;
        font-size: 10px;
        border-radius: 12px
      }
    </style>
    <script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js'></script>
    <script>
      $(window).on('load', function() {
        $('#user').val('');
        $('#email').val('')
        $('#retype-pass').prop('disabled', true);
      });

      $('#pass').on('input', function() {
        let v = $('#pass').val();
        if (v != '') {
          $('#retype-pass').prop('disabled', false);
        } else {
          $('#retype-pass').prop('disabled', true);
        }
      });

      $.fn.api.settings.api = {
        'register-user' : 'http://localhost:4000/users'
      }

      $('.button')
        .api({
          action: 'register-user',
          method: 'POST',
          dataType: 'text',
          beforeXHR: function(xhr) {
            xhr.setRequestHeader('Content-Type', 'application/json');
            return xhr;
          },
          beforeSend: function(settings) {
            let ex = false

            let name = $('#user').val()
            if (name == '') {
              $('#err-user').text('Username cannot be empty').css('color', 'deeppink')
              $('#user').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else {
              $('#err-user').text('none').css('color', 'white')
              $('#user').parent().css('border-bottom-color', 'gainsboro')
            }

            let email = $('#email').val()
            if (email == '') {
              $('#err-email').text('Email cannot be empty').css('color', 'deeppink')
              $('#email').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else if (!(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(email))) {
              $('#err-email').text('Invalid email address').css('color', 'deeppink')
              $('#email').parent().css('border-bottom-color', 'deeppink')
            } else {
              $('#err-email').text('none').css('color', 'white')
              $('#email').parent().css('border-bottom-color', 'gainsboro')
            }

            let pass = $('#pass').val()
            if (pass == '') {
              $('#err-pass').text('Password cannot be empty').css('color', 'deeppink')
              $('#pass').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else {
              $('#err-pass').text('none').css('color', 'white')
              $('#pass').parent().css('border-bottom-color', 'gainsboro')
            }

            let retype_pass = $('#retype-pass').val()
            if (retype_pass == '') {
              $('#err-retype-pass').text('Password cannot be empty').css('color', 'deeppink')
              $('#retype-pass').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else if (pass != retype_pass) {
              $('#err-retype-pass').text('Password does not match').css('color', 'deeppink')
              $('#retype-pass').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else {
              $('#err-retype-pass').text('none').css('color', 'white')
              $('#retype-pass').parent().css('border-bottom-color', 'gainsboro')
            }

            if (!($('#gdpr').is(':checked'))) {
              $('#gdpr').parent().css('border-bottom-color', 'deeppink')
              ex = true
            } else {
              $('#gdpr').parent().css('border-bottom-color', 'white')
            }

            if (ex) {
              return false;
            }

            let data = {
              name: $('#user').val(),
              email: $('#email').val(),
              password: $('#pass').val(),
              created: Date.now(),
              last_login: 0
            }
            settings.data = JSON.stringify(data)
            return settings;
          }
        });
    </script>
  </body>
</html>
